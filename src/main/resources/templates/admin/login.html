<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <link rel="stylesheet" href="/css/iconfont.css">
    <link rel="stylesheet" href="/css/font.css">
    <link rel="stylesheet" href="/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/xadmin.js"></script>
</head>
<body class="login-bg">
<div class="login" id="userForm">
    <div style="color: #031a12;text-align: center;margin-bottom: 18px;"><strong style="font-size: 18px;">沃得码后台管理系统</strong> </div>
    <div class="message">用户登录</div>
    <div id="darkbannerwrap"></div>
    <form method="post" class="layui-form">
        <input name="userName" placeholder="用户名" type="text" lay-verify="required" class="layui-input">
        <hr class="hr15">
        <input name="userPwd" lay-verify="required" placeholder="密码" type="password" class="layui-input">
        <hr class="hr15">
        <input value="登录" lay-submit lay-filter="login" style="width:100%;" type="submit">
        <hr class="hr15">
    </form>
    <span class="linecolor">----------------------------------</span>
    <svg t="1611306215972" style="color:#067c65;    vertical-align: -0.56em;" class="icon" viewBox="0 0 2432 1024"
         version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6737" width="32" height="32">
        <path d="M1212.257 899.025l798.493-834.788h421.023v130.662h-370.21l-849.306 892.86-849.306-892.86h-362.951v-130.662h421.023z"
              p-id="6738" data-spm-anchor-id="a313x.7781069.0.i0" class="selected" fill="#515151"></path>
    </svg>
    <span class="linecolor">----------------------------------</span>
    <div style="margin-top: 15px">
        <a class="layui-btn-primary layui-btn layui-btn-xs " href="/admin/registerPage" style="width: 100px;">
            <svg t="1611314317529" class="icon" style=" width: 1.6em; height: 1.6em; vertical-align: -0.44em" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3528" width="300" height="300"><path d="M315.3 420.3c3.3 4.8 6.2 8.4 9.5 11 3.7 2.2 7.3 4 11 5.5 0.4 1.6 0.9 3.1 1.3 4.7C351.6 542.2 441.7 620 503.5 620c62.1 0 152.8-78.5 166.5-179.9 0.4-1.3 0.7-2.6 1.1-4 5.5-1.5 10.3-4 14.7-8.4 3.7-3.7 7.3-9.2 11-15.8 3.7-6.6 5.9-15.8 7.3-26.8 1.5-8.4 1.1-15.8-0.4-21.7-1.5-5.9-3.3-10.6-5.1-14.3-2.6-4-5.5-7.3-8.4-9.9 0.7-20.9-0.4-41.9-3.7-62.8-3.3-17.6-7.7-37.1-14.3-57.6-6.6-20.9-16.5-39.3-30.1-56.2-11.7-14.7-30.1-28.6-54.7-41.5-25-12.8-52.9-19.5-84.4-19.5-11.7 0-24.2 1.1-37.1 2.9-12.9 1.8-26.1 5.5-38.9 10.6-12.8 5.1-25.7 12.5-37.8 21.7-12.5 9.2-23.5 21.3-33.4 36-11.4 16.2-19.5 33.8-24.6 52.5-5.1 19.1-8.8 37.1-11.4 54.3-2.6 20.2-3.3 40.4-2.9 60.2-4 4.8-7.3 10.3-9.9 16.5-2.6 5.1-4 11.4-4.8 19.1-0.7 7.7 0.4 16.2 3.7 24.6 2.8 8.5 5.8 15.5 9.4 20.3z" p-id="3529" fill="#1296db"></path><path d="M586.2 752.9c0-47 22.9-88.8 58.1-114.8 4.2-3.1 3.9-9.5-0.7-12.1-6-3.4-11.1-7.1-15.4-10.8 0 0 0 0.3-0.1 0.3-23.9 34.8-47.7 66-71.6 100.2-3 4.3-9.4 4.1-12.1-0.4-10.5-17.5-21.1-33.3-31.6-50.8-2.6-4.4-8.9-4.7-12-0.6-13.3 17.7-26.6 35.5-39.9 53.2-2.9 3.9-8.9 3.8-11.7-0.2-22.3-31.7-44.5-63.5-66.8-95.2-2.4-3.4-7.1-4.1-10.3-1.5-3.8 2.9-8 6-12.7 9.1-14 9.5-30.1 16.2-48.5 20.9-18.4 4.8-36 9.9-53.2 16.2-17.3 6.2-32.3 14.3-44.8 24.2-12.5 9.9-20.6 24.6-23.5 44.4-5.1 33.8-5.9 61.7-2.9 83.3 3.2 21.1 7.1 33.8 11.7 38.5 0.2 0.3 0.5 0.5 0.8 0.7 3.5 2.5 10.7 4.9 22.3 7.8 12.1 2.9 26.8 5.5 44.4 8.4 17.6 2.6 37.1 5.1 58 7.3 20.9 1.8 42.2 4 63.9 5.9 21.7 1.8 42.6 3.3 62.4 4.8 20.2 1.1 37.8 1.8 53.2 1.8 15.4 0 33.4-0.7 53.6-1.8 20.6-1.5 41.5-2.9 63.5-4.8 8.6-0.7 17.2-1.5 25.7-2.4 6.7-0.7 8.9-9.4 3.3-13.2-38-25.6-63.1-69.1-63.1-118.4z" p-id="3530" fill="#1296db"></path><path d="M728.8 636.4c-14.6 0-28.6 2.7-41.4 7.6-43.8 16.7-75 59.2-75 108.9 0 64.2 52.3 116.5 116.5 116.5 37 0 70-17.3 91.3-44.3 15.7-19.9 25.1-45 25.1-72.2 0-64.3-52.3-116.5-116.5-116.5z m61.7 130.4h-48.1v48.1c0 6.8-5.6 12.4-12.4 12.4-6.8 0-12.4-5.6-12.4-12.4v-48.1h-48.1c-6.8 0-12.4-5.6-12.4-12.4 0-6.8 5.6-12.4 12.4-12.4h48.1v-48.1c0-6.8 5.6-12.4 12.4-12.4 6.8 0 12.4 5.6 12.4 12.4V742h48.1c6.8 0 12.4 5.6 12.4 12.4 0 6.8-5.5 12.4-12.4 12.4z" p-id="3531" fill="#1296db"></path></svg>
            注册</a>
        <button class="layui-btn layui-btn-xs layui-btn-primary  " style="width: 100px;margin-left: 130px" type="button" onclick="changeLogin(1)">
            <span style="color: #05a4fa" class="iconfont icon-youxiang1"></span>
            邮箱登录
        </button>
    </div>
</div>
<!--邮箱登录-->
<div class="login" id="emailForm" style="display: none">
    <div class="message">邮箱验证登录</div>
    <div id="darkbannerwrap"></div>
    <form method="post" class="layui-form">
        <input id="email" name="email" placeholder="请输入邮箱" type="text" lay-verify="email" style="width: 62%;">
        <input type="submit" id="btn" value="发送验证码" lay-submit lay-filter="sendCode"
               style="width: 35%; font-size:12.5px;float: right">
        <hr class="hr15">
        <input name="code" id="code" placeholder="输入验证码" type="text" class="layui-input">
        <hr class="hr15">
        <input value="登录" lay-submit lay-filter="emailLogin" style="width:100%;" type="submit">
    </form>
    <hr class="hr15">
    <span class="linecolor">----------------------------------</span>
    <svg t="1611306215972" style="color:#067c65;    vertical-align: -0.56em;" class="icon" viewBox="0 0 2432 1024"
         version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6737" width="32" height="32">
        <path d="M1212.257 899.025l798.493-834.788h421.023v130.662h-370.21l-849.306 892.86-849.306-892.86h-362.951v-130.662h421.023z"
              p-id="6738" data-spm-anchor-id="a313x.7781069.0.i0" class="selected" fill="#515151"></path>
    </svg>
    <span class="linecolor">----------------------------------</span>
    <div style="margin: 15px 30%;"  >
        <button class="layui-btn layui-btn-xs  layui-btn-primary " id="email_btn" type="button" onclick="changeLogin(0)"
        ><i class="layui-icon-friends layui-icon" style="color: #0bb5f6">&#xe612;</i>用户名登录
        </button>
    </div>

</div>
<script>
    //用户登录函数
    $(function () {
        layui.use('form', function () {
            var form = layui.form;
            // layer.msg('玩命卖萌中', function(){
            //   //关闭后的操作
            //   });
            //监听提交
            form.on('submit(login)', function (data) {
                $.ajax({
                    url: "/admin/loginAjax",
                    type: "post",
                    data: data.field,
                    dataType: "json",//返回的数据类型
                    success: function (data) {
                        console.log(data)
                        //定义{info:"success"}
                        // $("#info").text(data.info);
                        if (data.info == "登录成功") {
                            window.location.href = "/index/homePage";

                            layer.msg(data.info, {
                                icon: 1,
                                time: 1000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {
                            });
                        } else {

                            layer.msg( data.info, {
                                icon: 2,
                                time: 1000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {
                            });
                        }
                    }
                })
                return false;
            });
        });
    })

    //用户名登录和邮箱验证登录的表单切换函数
    function changeLogin(num) {


        if (num == 1) {
            //显示 邮箱登录表单
            $("#emailForm").show();
            //隐藏 用登录表单
            $("#userForm").hide();
            $(".message").text("邮箱登录")
        } else {
            //显示 用户登录表单
            $("#userForm").show();
            //隐藏 邮箱登录表单
            $("#emailForm").hide();
            //更改标题
            $(".message").text("用户登录")
        }
    }

    // 验证码发送

    layui.use('form', function () {
        var form = layui.form;
        // layer.msg('玩命卖萌中', function(){
        //   //关闭后的操作
        //   });
        //监听提交
        form.on('submit(sendCode)', function (data) {
            console.log(data);
            $.ajax({
                url: "/admin/sendEmail",
                type: "post",
                data: data.field,
                dataType: "json",//返回的数据类型
                success: function (data) {
                    //定义{info:"success"}
                    layer.msg(data.info);
                }
            })

            //倒计时60s
            var oBtn = document.getElementById("btn");
            var time = 60;
            var timer = null;
            oBtn.value = time + '秒后重新发送';
            oBtn.setAttribute('disabled', 'disabled');  // 禁用按钮
            oBtn.setAttribute('class', 'disabled');   // 添加class 按钮样式变灰

            timer = setInterval(function () {

                if (time == 1) {
                    clearInterval(timer);
                    oBtn.value = '获取验证码';
                    oBtn.removeAttribute('disabled');
                    oBtn.removeAttribute('class');
                } else {
                    time--;
                    oBtn.value = time + '秒后重新发送';
                }
            }, 1000)

        });
    })
    //邮箱登录
    layui.use('form', function () {
            var form = layui.form;
            form.on('submit(emailLogin)', function (data) {
                    //发送 ajax请求
                    $.ajax({
                        url: "/admin/emailLogin",
                        type: "post",
                        data: data.field,
                        dataType: "json",//返回的数据类型
                        success: function (data) {
                            //定义{info:"success"}
                            if(data.info == "登录成功")
                            {
                                layer.msg(data.info, {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                }, function () {
                                        window.location.href = "/index/homePage";
                                });
                            }
                            else if (data.info == "邮箱未注册,")
                            {
                                layer.msg(data.info+"即将跳转注册>>", {
                                    icon: 2,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                }, function () {
                                        window.location.href = "/admin/registerPage";
                                });
                            }else
                                layer.msg(data.info,{icon:2,time:2000}
                                );
                        }
                    })
                    return false;
                }
            )
        }
    )


</script>